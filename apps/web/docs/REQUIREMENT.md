# PromPalette Web/API 要件定義書 v3.0

## 1. プロジェクト概要

### 1.1 目的

- デスクトップアプリで作成したプロンプトをクラウドで管理・共有
- 高品質なプロンプトを発見できるコミュニティプラットフォームの提供
- デスクトップアプリと連携した統合的なプロンプト管理環境の構築

### 1.2 ターゲットユーザー

- **プライマリ**: 個人利用者、小規模チーム（2-10人）
- **セカンダリ**: 将来的な企業ユーザー（エンタープライズ版）
- **地域**: 初期は日本のみ、将来的にグローバル展開

### 1.3 価値提案

- **デスクトップユーザー**: プロンプトのクラウド管理と優秀プロンプトの発見・ダウンロード
- **Web専用ユーザー**: デスクトップアプリなしでも完全なプロンプト管理が可能
- **コミュニティ**: 高品質プロンプトの共有・発見・改良のエコシステム

### 1.4 技術スタック方針

- **フロントエンド**: Next.js + TypeScript + Tailwind CSS
- **データベース**: PostgreSQL（リレーショナルDB採用）
- **認証**: OAuth対応（Google、Apple、GitHub）
- **ホスティング**: Vercel + クラウドデータベース
- **開発手法**: モノレポ構成

## 2. 機能要件

### 2.1 MVP機能（Phase 1: 必須実装）

#### 2.1.1 認証・アカウント管理

**アカウント作成・管理**

- メール・パスワードによるサインアップ・サインイン
- OAuth認証（Google、Apple、GitHub）
- パスワードリセット機能
- プロフィール管理（ユーザー名、表示名、プロフィール画像）
- アカウント設定変更
- アカウント削除機能

**要求仕様**

- 重複アカウント防止機能
- セキュアなパスワード管理
- 利用規約・プライバシーポリシー同意フロー

#### 2.1.2 シンプル権限管理（MVP）

**基本的な権限モデル**

- プロンプト単位での権限設定
- 公開レベル：Private（非公開）/ Public（完全公開）のみ
- 作成者ベースの権限：作成者のみが編集・削除可能

**将来への準備**

- GitHubライクな権限モデルへの拡張を前提とした設計
- URL構造：`/username/prompt-name`（将来的に`/username/collection-name/prompt-name`へ拡張）
- データベース設計：将来のコレクション・組織機能を考慮した構造

#### 2.1.2 プロンプト管理（CRUD）

**基本機能**

- プロンプト作成（タイトル、内容、タグ付け）
- 公開設定（完全公開・非公開の選択）
- プロンプト詳細表示
- プロンプト編集・更新
- プロンプト削除（論理削除）

**高度機能**

- マークダウンプレビュー機能
- リアルタイムプレビュー
- オートセーブ機能
- バージョン履歴管理（直近20件保持）
- バージョン復元機能

**データ要件**

- 1プロンプトあたり最大50,000文字
- タグは最大10個まで
- バージョン履歴は更新日時で管理

#### 2.1.3 検索・発見機能

**検索機能**

- キーワード検索（タイトル・内容での全文検索）
- タグによる絞り込み検索
- 複合検索（キーワード + タグの組み合わせ）
- クイックアクセスキー検索

**一覧表示機能**

- パブリックプロンプト一覧表示
- ソート機能（人気順・新着順・更新順）
- ページネーション（1ページ20件）
- 検索結果のハイライト表示

**要求仕様**

- 検索結果は2秒以内に表示
- 日本語での自然な検索対応
- 検索履歴の保存（ローカルストレージ）

#### 2.1.4 デスクトップアプリ連携

**認証連携**

- 同一アカウントでのOAuth認証
- デスクトップアプリからのWebアカウント利用

**データ同期**

- Web→デスクトップ：手動ダウンロード
- デスクトップ→Web：手動アップロード
- 選択的同期（個別プロンプト選択）
- 同期状況の可視化

**競合解決**

- 更新日時ベースでの上書き
- バージョン履歴による変更追跡
- 同期前の確認ダイアログ

### 2.2 将来機能（Phase 2以降：GitHubライクな権限モデル）

#### 2.2.1 プロンプトコレクション機能

**GitHubのRepository概念を応用**

- コレクション作成・管理（テーマ別プロンプト集）
- コレクション単位での権限管理
- URL構造：`/username/collection-name/prompt-name`

**権限レベル（GitHub準拠）**

- Read：閲覧、ダウンロード、フォーク
- Write：編集、プロンプト追加
- Maintain：設定変更、共有管理
- Admin：削除、所有権移転

#### 2.2.2 組織・チーム管理

**Organization機能**

- 企業・大規模チーム向けの組織管理
- 組織内でのプロンプトコレクション共有
- メンバー管理・権限管理

**Team機能**

- 部署・プロジェクト単位のチーム作成
- チーム内でのコラボレーション
- チーム専用プロンプトコレクション

**権限継承システム**

- Organization Owner → 全チーム・コレクション管理
- Team Maintainer → 所属チーム内の管理
- Member → 権限付与されたリソースのみアクセス

#### 2.2.3 高度な共有・コラボレーション

**GitHub Issue/PR概念の応用**

- プロンプト改善提案（Issue機能）
- プロンプト変更提案・レビュー（Pull Request機能）
- フォーク・マージによるプロンプト改良

**可視性レベル（GitHub準拠）**

- Public：全世界に公開
- Internal：組織内のみ公開
- Private：招待者のみアクセス

**高度な権限機能**

- 期間限定アクセス権
- チーム・個人への詳細権限設定
- アクセス履歴・監査ログ

#### 2.2.4 エンタープライズ機能

- Single Sign-On（SSO）対応
- Active Directory連携
- 詳細な分析・レポート機能
- 高度なセキュリティ設定

## 3. データ要件

### 3.1 主要エンティティ

#### 3.1.1 ユーザー（User）

- ユーザーID（プライマリキー）
- メールアドレス（一意制約）
- ユーザー名（一意制約、3-20文字）
- 表示名（1-50文字）
- プロフィール画像URL
- OAuth情報（プロバイダー、外部ID）
- ユーザー設定（JSON形式）
- 作成日時・更新日時

#### 3.1.2 プロンプト（Prompt）- MVP仕様

- プロンプトID（プライマリキー）
- ユーザーID（外部キー）
- タイトル（1-255文字）
- 内容（最大50,000文字）
- タグ（配列、最大10個）
- 公開設定（private・public のみ）
- メタデータ（クイックアクセスキー等）
- 統計情報（いいね数・フォーク数・閲覧数）
- 作成日時・更新日時

#### 3.1.3 将来拡張用エンティティ（設計考慮のみ）

**プロンプトコレクション（Collection）**

- コレクションID、名前、説明
- 所有者（ユーザー・組織・チーム）
- 可視性レベル（public・internal・private）

**組織・チーム（Organization/Team）**

- 組織・チーム情報
- メンバーシップ・役割管理
- 階層的権限構造

**権限管理（Permissions）**

- リソース単位での詳細権限
- 役割ベースアクセス制御
- 権限継承システム

#### 3.1.4 バージョン履歴（PromptVersion）

- バージョンID（プライマリキー）
- プロンプトID（外部キー）
- バージョン番号
- タイトル・内容（その時点の値）
- 変更概要
- 作成日時

#### 3.1.5 タグ（Tag）

- タグID（プライマリキー）
- タグ名（一意制約）
- 説明
- 使用回数
- 作成日時

### 3.2 データ関連・制約

#### 3.2.1 リレーション

- ユーザー：プロンプト = 1：N
- プロンプト：バージョン履歴 = 1：N
- プロンプト：タグ = N：N（関連テーブル）
- ユーザー：いいね：プロンプト = N：N：N

#### 3.2.2 データ制約

- ユーザー名は英数字・ハイフン・アンダースコアのみ
- プロンプトタイトルは必須入力
- 削除は論理削除（削除フラグ管理）
- バージョン履歴は最大20件（古いものを自動削除）

### 3.3 データベース設計方針

#### 3.3.1 PostgreSQL採用理由

- リレーショナルデータに最適
- 複雑な権限管理に対応（将来のGitHubモデル実装）
- 高度な検索機能（全文検索・JSONB）
- デスクトップアプリ（SQLite）からの移行が容易
- 将来的なベクトル検索対応可能

#### 3.3.2 MVP設計方針

- **シンプル開始**：最小限のテーブル構成
- **拡張準備**：将来のGitHubモデル拡張を考慮した設計
- **マイグレーション**：段階的な機能追加に対応

#### 3.3.3 将来拡張への考慮

- **URL設計**：`/username/prompt-name` → `/username/collection-name/prompt-name`
- **権限テーブル**：将来の詳細権限管理に対応可能な構造
- **組織・チーム**：エンタープライズ機能への拡張パス確保

#### 3.3.4 パフォーマンス考慮

- 適切なインデックス設計
- 検索用の全文検索インデックス
- タグ検索用のJSONBインデックス
- ページネーション最適化

## 4. システム要件

### 4.1 非機能要件

#### 4.1.1 パフォーマンス要件

- **レスポンス時間**: ページ読み込み2秒以内
- **検索応答時間**: 検索結果表示1秒以内
- **同時接続数**: 初期500ユーザー、将来10,000ユーザー対応
- **データ容量**: 1ユーザーあたり100プロンプト想定

#### 4.1.2 可用性要件

- **稼働率**: 99.5%以上
- **ダウンタイム**: 月間3.6時間以内
- **災害復旧**: 24時間以内の復旧
- **バックアップ**: 日次自動バックアップ

#### 4.1.3 セキュリティ要件

- **認証セキュリティ**: OAuth 2.0・JWT採用
- **データ保護**: 個人情報保護法・GDPR準拠
- **通信暗号化**: HTTPS強制・TLS 1.3以上
- **不正アクセス対策**: レート制限・SQL注入対策

#### 4.1.4 ユーザビリティ要件

- **アクセシビリティ**: WCAG 2.1 AA準拠
- **レスポンシブ対応**: スマートフォン・タブレット対応
- **多言語対応**: 初期は日本語のみ、将来英語対応
- **ブラウザ対応**: Chrome・Firefox・Safari・Edge最新版

### 4.2 技術要件

#### 4.2.1 アーキテクチャ要件

- **モノレポ構成**: フロントエンド・デスクトップアプリ・共通パッケージ
- **API設計**: RESTful API、将来的にGraphQL検討
- **データベース**: PostgreSQL、適切な正規化
- **認証基盤**: OAuth 2.0対応、セッション管理

#### 4.2.2 開発・運用要件

- **コード品質**: TypeScript使用、リンター・フォーマッター適用
- **テスト**: 単体テスト・統合テスト・E2Eテスト
- **CI/CD**: 自動テスト・自動デプロイ
- **監視**: アプリケーション監視・エラートラッキング

## 5. インターフェース要件

### 5.1 ユーザーインターフェース

#### 5.1.1 主要画面

- **ホーム画面**: プロンプト一覧・検索・人気プロンプト
- **プロンプト詳細画面**: 内容表示・編集・バージョン履歴
- **プロンプト作成/編集画面**: エディタ・プレビュー・設定
- **検索結果画面**: 検索結果一覧・フィルタリング
- **プロフィール画面**: ユーザー情報・作成プロンプト一覧
- **設定画面**: アカウント設定・同期設定

#### 5.1.2 デザイン要件

- **デザインシステム**: 一貫性のある UI/UX
- **アクセシビリティ**: キーボード操作・スクリーンリーダー対応
- **レスポンシブ**: モバイルファースト設計
- **パフォーマンス**: 軽量・高速表示

### 5.2 APIインターフェース

#### 5.2.1 内部API（Web⇔デスクトップ）

- **認証API**: OAuth認証・セッション管理
- **プロンプトAPI**: CRUD操作・検索
- **同期API**: アップロード・ダウンロード・競合解決
- **ユーザーAPI**: プロフィール管理

#### 5.2.2 外部API（将来的）

- **公開API**: 第三者アプリケーション向け
- **Webhook**: 外部システム連携
- **Analytics API**: 統計データ提供

### 5.3 データインターフェース

#### 5.3.1 データベース接続

- **接続プール**: 効率的なデータベース接続管理
- **トランザクション**: データ整合性保証
- **マイグレーション**: スキーマ変更管理

#### 5.3.2 ファイルストレージ

- **プロフィール画像**: クラウドストレージ保存
- **バックアップデータ**: 定期的なデータエクスポート
- **ログファイル**: アプリケーション・アクセスログ

## 6. 制約条件

### 6.1 技術制約

#### 6.1.1 開発環境制約

- **開発体制**: 個人または小規模チーム（1-3人）
- **開発期間**: MVP完成まで2-3ヶ月
- **技術スキル**: Next.js・TypeScript・PostgreSQLの知識必要
- **予算制約**: 初期運用コスト月額$50以下

#### 6.1.2 運用制約

- **サポート体制**: 平日対応、24/7運用は不可
- **言語対応**: 初期は日本語のみ
- **法的対応**: 日本の法律準拠
- **スケール制限**: 初期は中小規模対応

### 6.2 ビジネス制約

#### 6.2.1 収益モデル制約

- **基本機能無料**: 多くの機能を無料提供
- **マネタイゼーション**: 将来的な有料機能検討
- **広告掲載**: 初期は広告収入なし

#### 6.2.2 競合環境制約

- **差別化要因**: デスクトップアプリとの連携
- **市場ポジション**: ニッチ市場での独自性確保
- **ユーザー獲得**: オーガニック成長中心

## 7. リスク・課題

### 7.1 技術リスク

#### 7.1.1 開発リスク

- **技術選択ミス**: 後戻りが困難な技術決定
- **パフォーマンス問題**: 大量データ処理での性能劣化
- **セキュリティ脆弱性**: 個人情報漏洩リスク
- **デスクトップ連携**: OAuth認証フローの複雑性

#### 7.1.2 運用リスク

- **スケーラビリティ**: 急激なユーザー増加への対応
- **データ損失**: バックアップ・復旧体制の不備
- **サービス依存**: 外部サービス（Supabase等）の障害影響
- **保守性**: コードベースの技術的負債蓄積

### 7.2 ビジネスリスク

#### 7.2.1 市場リスク

- **ユーザー獲得**: 初期ユーザー確保の困難
- **競合参入**: 大手企業による類似サービス
- **市場変化**: AI技術進歩による市場環境変化
- **収益化**: 持続可能なビジネスモデル確立

#### 7.2.2 法的・社会的リスク

- **プライバシー規制**: 個人情報保護法規制強化
- **コンテンツ責任**: 不適切プロンプト投稿への対応
- **知的財産**: プロンプト著作権問題
- **国際展開**: 各国の法規制への対応

### 7.3 リスク対策

#### 7.3.1 技術的対策

- **段階的実装**: MVP→機能拡張の段階的開発
- **技術検証**: 事前のPoC・プロトタイプ作成
- **監視体制**: アプリケーション・インフラ監視
- **バックアップ**: 自動化されたバックアップ体制

#### 7.3.2 ビジネス的対策

- **ユーザーテスト**: 早期のユーザーフィードバック収集
- **柔軟な計画**: 市場変化に応じた計画変更
- **コミュニティ**: ユーザーコミュニティの育成
- **法的準備**: 利用規約・プライバシーポリシー整備

## 8. 品質保証

### 8.1 テスト要件

#### 8.1.1 機能テスト

- **単体テスト**: 各機能の個別テスト
- **統合テスト**: システム間連携テスト
- **E2Eテスト**: ユーザーシナリオベーステスト
- **セキュリティテスト**: 脆弱性・ペネトレーションテスト

#### 8.1.2 非機能テスト

- **パフォーマンステスト**: 負荷・ストレステスト
- **ユーザビリティテスト**: 実ユーザーによる使用性評価
- **アクセシビリティテスト**: 障害者対応確認
- **ブラウザテスト**: 各ブラウザでの動作確認

### 8.2 品質管理

#### 8.2.1 開発品質

- **コードレビュー**: 複数人によるコード審査
- **静的解析**: リンター・フォーマッターによる品質維持
- **技術負債管理**: 定期的なリファクタリング
- **ドキュメント**: 設計書・仕様書の維持

#### 8.2.2 運用品質

- **監視**: システム監視・アラート設定
- **ログ管理**: アプリケーション・アクセスログ分析
- **インシデント対応**: 障害対応手順・体制整備
- **継続改善**: ユーザーフィードバックに基づく改善

## 9. 成功指標・KPI

### 9.1 開発成功指標

#### 9.1.1 MVP完成指標

- **機能完成度**: 要求機能100%実装
- **品質指標**: バグ密度1件/1000行以下
- **パフォーマンス**: 要求仕様達成
- **セキュリティ**: 脆弱性検査クリア

#### 9.1.2 技術指標

- **可用性**: 稼働率99.5%以上
- **レスポンス**: 平均応答時間2秒以下
- **エラー率**: システムエラー0.1%以下
- **同期成功率**: デスクトップ連携95%以上

### 9.2 ビジネス成功指標

#### 9.2.1 ユーザー指標

- **登録ユーザー数**: MVP完了時100人、1年後1,000人
- **アクティブユーザー**: 月間アクティブ率60%以上
- **継続率**: 30日継続率60%以上
- **プロンプト投稿数**: 1ユーザーあたり平均10個以上

#### 9.2.2 品質指標

- **ユーザー満足度**: アプリストア評価4.0以上
- **プロンプト品質**: ユーザー評価平均4.0以上
- **検索精度**: 関連プロンプト発見率80%以上
- **サポート品質**: 問い合わせ24時間以内回答率90%

## 10. プロジェクト計画

### 10.1 開発スケジュール

#### 10.1.1 Phase 1: MVP開発（12週間）

**MVP権限管理の範囲**

- シンプルなPrivate/Public権限のみ
- 作成者ベースの権限制御
- 基本的なRow Level Security実装

**開発詳細**

- **Week 1-2**: 要件詳細化・技術選定・環境構築
- **Week 3-4**: 認証システム・基盤機能開発
- **Week 5-6**: プロンプトCRUD機能開発・シンプル権限実装
- **Week 7-8**: 検索・発見機能開発
- **Week 9-10**: デスクトップ連携機能開発
- **Week 11-12**: テスト・調整・リリース準備

#### 10.1.2 Phase 2: GitHubライク権限導入（8-12週間）

**段階的権限拡張**

- **Week 1-3**: プロンプトコレクション機能実装
- **Week 4-6**: 基本的な共有機能（Read/Write権限）
- **Week 7-8**: チーム・組織管理基盤
- **Week 9-12**: コラボレーション機能（Issue/PR相当）

#### 10.1.3 Phase 3: エンタープライズ機能（12-16週間）

**高度な権限管理**

- 詳細な権限レベル実装
- SSO・AD連携
- 監査ログ・分析機能
- 高度なセキュリティ機能

### 10.2 リソース計画

#### 10.2.1 人的リソース

- **開発者**: フルスタック開発者1-2名
- **デザイナー**: UI/UXデザイン（パートタイム）
- **テスター**: ユーザビリティテスト（外部委託）

#### 10.2.2 予算計画

- **開発コスト**: 人件費中心
- **インフラコスト**: 月額$0-50（段階的拡張）
- **ツール・ライセンス**: 開発ツール費用
- **マーケティング**: 初期はオーガニック中心

## 12. 権限管理設計詳細

### 12.1 段階的権限モデル実装

#### 12.1.1 Phase 1: MVP権限管理

**シンプルな2レベル権限**

```
権限レベル:
- Private: 作成者のみアクセス可能
- Public: 全世界からアクセス可能

権限チェック:
- 閲覧: Public または 作成者
- 編集: 作成者のみ
- 削除: 作成者のみ
```

**技術実装方針**

- Row Level Security (RLS) による権限制御
- シンプルな権限チェック関数
- 将来拡張を見据えたテーブル設計

#### 12.1.2 Phase 2: GitHubライク権限管理

**コレクション中心の権限モデル**

```
権限構造:
Collection (Repository相当)
├── Read: 閲覧・ダウンロード・フォーク
├── Write: 編集・プロンプト追加
├── Maintain: 設定変更・共有管理
└── Admin: 削除・所有権移転

可視性レベル:
- Public: 全世界公開
- Internal: 組織内公開
- Private: 招待者のみ
```

**組織・チーム階層**

```
Organization
├── Owner: 組織全体管理
├── Member: 基本権限
└── Teams
    ├── Maintainer: チーム管理
    └── Member: チーム内権限
```

#### 12.1.3 Phase 3: エンタープライズ権限管理

**高度な権限制御**

- 詳細な役割ベースアクセス制御 (RBAC)
- 期間限定アクセス権
- 条件付きアクセス制御
- 監査ログ・コンプライアンス対応

### 12.2 URL設計・ユーザー体験

#### 12.2.1 段階的URL構造

**Phase 1 (MVP)**

```
/username/prompt-name
例: /tanaka/code-review-prompt
```

**Phase 2 (Collection導入)**

```
/username/collection-name/prompt-name
例: /tanaka/dev-tools/code-review-prompt

/org/organization-name/collection-name/prompt-name
例: /org/abc-company/marketing/ad-copy-generator
```

#### 12.2.2 権限表示・管理UI

**MVP段階**

- シンプルな公開/非公開切り替え
- 基本的な権限表示

**GitHubライク段階**

- 詳細な権限設定画面
- コラボレーター管理機能
- アクセス履歴表示

## 13. 次のステップ

### 13.1 immediate Actions（即座に開始）

1. **MVP権限設計確定**: シンプルなPrivate/Public権限の詳細仕様
2. **技術スタック最終決定**: Supabase vs Railway最終選択
3. **プロジェクト環境構築**: モノレポ・開発環境セットアップ
4. **データベース基盤設計**: MVP + 将来拡張を考慮したスキーマ設計

### 13.2 Short-term Actions（1-2週間以内）

1. **MVP認証・権限プロトタイプ**: 基本的なRLS実装検証
2. **URL設計確定**: 現在・将来の両方を考慮した設計
3. **API仕様策定**: シンプルなMVP仕様から詳細設計
4. **GitHubモデル詳細設計**: Phase 2以降の具体的な実装方針

### 13.3 Medium-term Actions（1ヶ月以内）

1. **MVP開発開始**: シンプル権限での基盤機能実装
2. **拡張性検証**: GitHubモデルへの移行パス検証
3. **ユーザーテスト計画**: 段階的な権限拡張に対するユーザー反応調査
4. **Phase 2準備**: コレクション・組織機能の詳細設計開始

この要件定義書をベースに、**シンプルなMVP開始 → GitHubライクな本格権限管理**への段階的発展が可能な開発に移行できます。
